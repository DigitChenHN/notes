## 简介
灰色模型是一种基于灰色系统理论的预测模型。主要的特点在于**不需要对数据分布进行严格的假设**，因此对于小样本、信息不完全的情况比较适用。  

## 基本原理 
灰度模型的核心是通过对原始数据进行“累加生成”（Accumulated Generating Operation，简称AGO）和“累减生成”（Inverse Accumulated Generating Operation，简称IAGO）操作，将原始数据序列转换为具有指数规律的新序列，从而建立微分方程模型进行预测。 

## 累加生成（AGO）
原始序列$x^{(0)} = \{x^{(0)}(1), x^{(0)}(2), ..., x^{(0)}(n)\}$，上标0代表了第一个序列，而括号中的n代表样本的个数，如果是时间序列，即第1年到第n年的数据。累加模型中，为了得到第二个数据序列，将当前项加上该项之前的所有项，就得到第二个序列中的当前项。用数学表达式表示经过第一次累加之后的序列为：$x^{(1)} = \{x^{(1)}(1), x^{(1)}(2), ..., x^{(1)}(n)\}$，其中$x^{(1)}(k) = \sum_{i=1}^k{x^{0}(i)}$。  

## 累减生成（IAGO）
累加生成的逆过程。模型的预测是以累加生成之后的序列作为输入的，所以得到模型的预测输出之后，需要用累减生成得到原始数据的预测值。  

## 灰色模型建模
最常见的灰色模型是G(1,1)，其中第一个1表示模型中只有一个因变量，第二个1表示模型自变量只有1个，也就是时间这个自变量。  
这个模型的基本思想是：许多实际系统的时间序列经过累加生成之后，其变化规律更加接近于指数规律。而一阶线性微分方程的解恰好是指数函数，因此可以用一阶线性微分方程来描述经过累加生成之后的序列。  
因此，G(1,1)模型可以对累加之后的序列建立以下一阶线性微分方程：  
$$\frac{dx^{(1)}}{dt} + ax^{(1)} = b$$  
在G(1,1)模型中我们将x视为一个函数，t是自变量，则由于这是一个一阶线性微分方程，其解x(t)是一个指数函数，符合灰色模型的假设：**多数实际系统的时间序列经过累加生成之后变化规律接近指数规律**。  
接着只要通过对这个方程进行求解，就可以得到x(t)的解，也就可以知道下一时刻的累加生成序列的值$x^{(1)}(k+1)$，而通过IAGO就可以得到原始序列的预测值$x^{(0)}(k+1)=x^{(1)}(k+1)-x^{(1)}(k)$。  
利用高等数学中解微分方程的知识可以得到这个方程的解析解为：  
$$x^{(1)}(t) = \left(x^{(1)}(1) - \frac{b}{a}\right)e^{-at} + \frac{b}{a}$$  
（这是一个指数函数）  
也就是说，我们需要根据已有数据拟合得到参数a和b的值。  

## 灰色模型的参数估计  
$$\frac{dx^{(1)}}{dt} + ax^{(1)} = b$$  

这是一个线性方程，拟合线性方程的参数可以用最小二乘法来估计。  

### 最小二乘法  
有一个线性模型：  
$$y = X \beta + \epsilon$$  
最小二乘法的思想就是得到使得误差平方和最小的参数$\beta$。  
当函数$\epsilon^{T}\epsilon = (y - X\beta)^{T}(y - X\beta)$对$\beta$求导数并令其为0时，得到的$\beta$就是最小二乘法的估计值。  
则最小二乘法得到的参数估计值为：
$$\hat{\beta} = (X^{T}X)^{-1}X^{T}y$$

### 灰色模型最小二乘法求解
对应到G(1,1)模型中，$\frac{dx^{(1)}}{dt}$就是y，而$\begin{pmatrix}x^{(1)}&1\end{pmatrix}$就是$X$，$\beta$就是参数$\begin{pmatrix}c\\d\end{pmatrix}$，$\epsilon$就是误差。  
上述的微分方程在灰色系统理论中称为“白化方程”，为了使用计算机求数值解，需要将其离散化为灰色离散方程：  
1. 离散化导数：$\frac{dx^{(1)}}{dt} \approx x^{(1)}(k) - x^{(1)}(k-1) = x^{(0)}(k)$   
2. 离散化连续函数：用**紧邻均值生成序列**$z^{(1)}(k) = \frac{1}{2}(x^{(1)}(k) + x^{(1)}(k-1))$来代替$x^{(1)}$

这样一来求解最小二乘法的公式中，
$$y = \begin{pmatrix}x^{(0)}(2)\\x^{(0)}(3)\\\vdots\\x^{(0)}(n)\end{pmatrix}$$
$$X = \begin{pmatrix}\frac{1}{2}(x^{(1)}(2) + x^{(1)}(1))&1\\\frac{1}{2}(x^{(1)}(3) + x^{(1)}(2))&1\\\vdots&\vdots\\\frac{1}{2}(x^{(1)}(n) + x^{(1)}(n-1))&1\end{pmatrix}$$  

## 总结
简单理解G(1,1)模型就是，一个时间序列数据，进行一次累加之后得到的序列，满足某种线性关系，问题转化为线性回归问题。  
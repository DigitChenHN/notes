## 为什么prompt需要优化  
transformer架构的语言大模型，其本质在于利用前一个token预测下一个token。因此prompt中最后一个token就是模型预测输入的第一个token的输入，注意力机制可以将距离比较远的token的语义结合到最后一个token中（对于注意力机制的理解可以参看[视频](https://www.bilibili.com/video/BV13z421U7cs/?spm_id_from=333.1387.collection.video_card.click&vd_source=d82de55cfde970cdf86016bef2c6de4e)）。  
因此，prompt整体的内容将决定了模型输出的内容。如果假设大模型是正确的，那么如果得不到想要的内容，就是prompt的问题。因此对prompt进行优化就非常重要。  

## prompt优化思路
参考[文章](https://zhuanlan.zhihu.com/p/670552915)举的一个例子。  

## 常见的prompt优化方法
从结构上看，可以有：  
- Few-shot(FS)：是指模型在推理时给予少量样本，但不允许进行权重更新。
- One-shot(1S)：与 Few-Shot 类似，但只允许一个样本。
- Zero-shot(ZS)：和 One-Shot 类似，但不允许提供样本，只给出描述任务的自然语言指令。该方法提供了最大的方便性、稳健性以及避免虚假相关的可能性，但也是最具挑战性的设置。在某些情况下，Zero-Shot 是最接近人类执行任务的方法。  

从prompt的内容上看，可以有：
- Role prompt：让大模型扮演特定的角色。  
- Instruction prompt：指令形式的prompt。
- Chain-of-Thought（CoT）：要求模型逐步推理。
- Multimodal Prompt：输入包含多模态信息，包括图片、文本等。   

其中Few-shot和Chain-of-thought效果比较稳定。

## 个人的一个prompt优化过程
场景：希望模型能够根据给定的一个新闻标题，生成指定数量的关键词或者关键句。  
初始prompt:这是今天的新闻标题“印度未事先通知突然开闸泄洪”，为了能够更好的了解这则新闻的内容，需要你根据这则新闻标题进行延申，生成5个关键词或者句子，方便我在搜索引擎搜索。  
输出：
```
1. 印度泄洪事件详情
2. 印度未通知泄洪原因
3. 印度突然开闸泄洪影响
4. 印度泄洪相关地区
5. 印度泄洪后续应对措施
```
再次输入prompt：这是今天的新闻标题“韩景敏：本土植物做染料 绘就多彩新疆”，为了能够更好的了解这则新闻的内容，需要你需要你根据这则新闻标题进行延申，生成8个关键词或者句子，方便我在搜索引擎搜索。  
输出：
```
1. 韩景敏
2. 本土植物染料
3. 新疆多彩染色技术
4. 天然染料应用
5. 新疆传统工艺
6. 植物染料绘画
7. 新疆文化特色
8. 环保染色方法
```
发现对应的模型可以稳定输出想要的内容，为了使得输出可以被后续工作流使用，我们考虑强制其格式化输出的内容，比如可以考虑让模型将每一个输出的关键词用*标记出来，这样可以方便我们后续使用正则表达式从输出中提取我们想要的内容。  
将prompt改为：这是今天的新闻标题“韩景敏：本土植物做染料 绘就多彩新疆”，为了能够更好的了解这则新闻的内容，需要你需要你根据这则新闻标题进行延申，生成4个关键词或者句子，方便我在搜索引擎搜索。注意，将每一个生成的关键词或句子用*标记出来。  
输出：  
```
1. 韩景敏 本土植物染料
2. 新疆本土植物染色技术
3. 多彩新疆 植物染料应用
4. 韩景敏与新疆植物染料艺术
```
可以发现模型并没有按照我们想要的进行输出，因此我们可以考虑给它一个例子，也就是采用one-shot的prompt方式。   
prompt：这是今天的新闻标题“韩景敏：本土植物做染料 绘就多彩新疆”，为了能够更好的了解这则新闻的内容，需要你需要你根据这则新闻标题进行延申，生成4个关键词或者句子，方便我在搜索引擎搜索。注意，将每一个生成的关键词或句子用*标记出来。比如输出3个关键词“韩景敏 本土植物染料“”新疆本土植物染色技术””多彩新疆 植物染料应用“，则应该输出\*韩景敏 本土植物染料\*，\*新疆本土植物染色技术\*，\*多彩新疆 植物染料应用\*。
输出：
```
*韩景敏 本土植物染料研究*
*新疆本土植物染色工艺*
*多彩新疆 植物染料创新*
*韩景敏与新疆植物染料艺术*
```
这样一来就可以在后续的应用中使用正则表达式从输出中提取我们想要的内容了。  

## 系统优化思路(CRISPE框架)

以上提到的prompt优化方法并不是独立的，可以使用一个提问框架很自然的构建比较优秀的prompt。  
CRISPE框架为：  
- CR：Capacity and Role（能力和角色），让ai扮演一个角色
- I：Insight（洞察），提供背景信息和上下文
- S：Statement（陈述），你希望ai做什么
- P：Personality（个性），你希望ai以什么风格回答
- E：Experiment（实验），要求ai给你提供多个答案

这个框架中，CR就是上面提到的Role prompt，而I就可以相当于One-shot或者Few-shot的prompt，P就相当于Chain-of-Thought。  

## prompt的持续优化
当我们需要大模型来完成一些复杂的工作时，需要不断迭代prompt。  
除了人工调节prompt，也可以让机器生成。论文AUTOPROMPT: Eliciting Knowledge from Language Models
 with Automatically Generated Prompts(https://arxiv.org/pdf/2010.15980)介绍了一种自动生成prompts的方法。